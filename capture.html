<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FRESCO Capture Reaction Generator</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <meta name="description" content="Generate input files for FRESCO capture calculations. Configure parameters for nuclear reaction simulations.">
    <meta name="keywords" content="FRESCO, capture, nuclear physics, reaction calculations">
    <meta name="author" content="Jin Lei">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/fresco-styles.css">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-J60NE88WR1"></script>
    <script src="assets/js/fresco-namelist.js"></script>
    <script src="assets/js/fresco-parameter-manager.js"></script>
    <script src="assets/js/fresco-parameter-ui.js"></script>
    <script src="assets/js/fresco-common.js"></script>
    <script src="assets/js/fresco-integration.js"></script>
    <script src="assets/js/fresco-generator.js"></script>
    <script src="assets/js/fresco-shared-components.js"></script>
</head>
<body>
    <!-- Header Section -->
    <header class="header">
        <div class="container">
            <h1><i class="fas fa-atom me-2"></i>Capture Reaction</h1>
            <p>Generate FRESCO input files for radiative capture reactions with electromagnetic transitions</p>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container my-4">
        <!-- Upload Section -->
        <div class="glass-card mb-4">
            <h3><i class="fas fa-upload me-2"></i>Upload Existing Input File</h3>
            <div class="row">
                <div class="col-md-6">
                    <label for="file-upload-capture" class="form-label">
                        Select FRESCO Input File
                        <span class="custom-tooltip">
                            <i class="fas fa-info-circle ms-1"></i>
                            <span class="tooltip-text">Upload an existing FRESCO input file (.in, .inp, .txt) to populate the form fields automatically.</span>
                        </span>
                    </label>
                    <input type="file" class="form-control" id="file-upload-capture" accept=".in,.inp,.txt" onchange="handleFileUpload(event, 'capture')">
                </div>
                <div class="col-md-6 d-flex align-items-end">
                    <button type="button" class="glass-btn" onclick="document.getElementById('file-upload-capture').click()">
                        <i class="fas fa-folder-open me-2"></i>Browse Files
                    </button>
                </div>
            </div>
            <small class="form-text">Supported formats: .in, .inp, .txt</small>
        </div>

        <form id="capture-form">
            <!-- General Parameters -->
            <div class="glass-card">
                <h3><i class="fas fa-cogs me-2"></i>General FRESCO Parameters</h3>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="header" class="form-label">
                            Header
                            <span class="custom-tooltip">
                                <i class="fas fa-info-circle ms-1"></i>
                                <span class="tooltip-text">Description of the calculation that will appear at the top of the input file.</span>
                            </span>
                        </label>
                        <input type="text" class="form-control" id="header" placeholder="14C(n,g)15C E1 only;">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="hcm" class="form-label">
                            Integration step size (hcm)
                            <span class="custom-tooltip">
                                <i class="fas fa-info-circle ms-1"></i>
                                <span class="tooltip-text">Step size for integration in center-of-mass frame. Smaller values give more accurate results but slower calculations (typical: 0.05-0.1).</span>
                            </span>
                        </label>
                        <input type="number" class="form-control" id="hcm" value="0.1" step="0.01">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="rmatch" class="form-label">
                            Matching radius (rmatch)
                            <span class="custom-tooltip">
                                <i class="fas fa-info-circle ms-1"></i>
                                <span class="tooltip-text">The radius at which the internal and asymptotic solutions are matched (typical: 20-100 fm for capture).</span>
                            </span>
                        </label>
                        <input type="number" class="form-control" id="rmatch" value="30">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="jtmax" class="form-label">
                            Max angular momentum (jtmax)
                            <span class="custom-tooltip">
                                <i class="fas fa-info-circle ms-1"></i>
                                <span class="tooltip-text">Maximum angular momentum included in the calculation. For capture reactions, typically around 5-10 is sufficient.</span>
                            </span>
                        </label>
                        <input type="number" class="form-control" id="jtmax" value="5">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="absend" class="form-label">
                            Convergence parameter (absend)
                            <span class="custom-tooltip">
                                <i class="fas fa-info-circle ms-1"></i>
                                <span class="tooltip-text">Convergence criterion. Use negative value to calculate all partial waves up to jtmax.</span>
                            </span>
                        </label>
                        <input type="number" class="form-control" id="absend" value="-1" step="0.001">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="thmax" class="form-label">
                            Maximum angle (thmax)
                            <span class="custom-tooltip">
                                <i class="fas fa-info-circle ms-1"></i>
                                <span class="tooltip-text">Maximum scattering angle in degrees. For capture reactions, set to 0 for total cross sections only.</span>
                            </span>
                        </label>
                        <input type="number" class="form-control" id="thmax" value="0">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="thinc" class="form-label">
                            Angle increment (thinc)
                            <span class="custom-tooltip">
                                <i class="fas fa-info-circle ms-1"></i>
                                <span class="tooltip-text">Increment between calculated scattering angles in degrees.</span>
                            </span>
                        </label>
                        <input type="number" class="form-control" id="thinc" value="1.0" step="0.1">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="elab" class="form-label">
                            Laboratory energy (elab)
                            <span class="custom-tooltip">
                                <i class="fas fa-info-circle ms-1"></i>
                                <span class="tooltip-text">Laboratory energy of the projectile in MeV. For multi-energy calculations, use comma-separated values.</span>
                            </span>
                        </label>
                        <input type="text" class="form-control" id="elab" value="0.005, 4.005">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="iter" class="form-label">
                            Number of iterations (iter)
                            <span class="custom-tooltip">
                                <i class="fas fa-info-circle ms-1"></i>
                                <span class="tooltip-text">Number of iterations for solving coupled equations. For capture reactions, a value of 1 is usually sufficient.</span>
                            </span>
                        </label>
                        <input type="number" class="form-control" id="iter" value="1" min="1">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="rintp" class="form-label">
                            Integration mesh size (rintp)
                            <span class="custom-tooltip">
                                <i class="fas fa-info-circle ms-1"></i>
                                <span class="tooltip-text">Radial integration mesh size in fm. Typical values are 0.1-0.5 fm.</span>
                            </span>
                        </label>
                        <input type="number" class="form-control" id="rintp" step="0.1">
                    </div>
                </div>
            </div>

            <!-- Dynamic Parameter Management System -->
            <div class="glass-card advanced-fresco-card">
                <h3><i class="fas fa-sliders-h me-2"></i>FRESCO Parameter Management</h3>
                <p class="text-white-50 mb-3">Dynamically manage parameters between General and Advanced sections. Upload a FRESCO file to automatically populate parameters.</p>
                
                <!-- Parameter Sections -->
                <div class="row">
                    <!-- General Parameters -->
                    <div class="col-md-6">
                        <div class="parameter-section mb-3" style="border: 1px solid #444; border-radius: 8px; overflow: hidden;">
                            <div class="section-header" style="background: #2c3e50; color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center;">
                                <span><i class="fas fa-star me-2"></i>General FRESCO Parameters</span>
                                <span class="badge bg-primary" id="generalCount">0</span>
                            </div>
                            <div class="parameter-list" id="generalParameters" style="max-height: 400px; overflow-y: auto; padding: 10px;">
                                <!-- General parameters will be populated here -->
                            </div>
                        </div>
                    </div>

                    <!-- Advanced Parameters -->
                    <div class="col-md-6">
                        <div class="parameter-section mb-3" style="border: 1px solid #444; border-radius: 8px; overflow: hidden;">
                            <div class="section-header" style="background: #8e44ad; color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center;">
                                <span><i class="fas fa-cogs me-2"></i>Advanced FRESCO Parameters</span>
                                <span class="badge bg-secondary" id="advancedCount">0</span>
                            </div>
                            <div class="parameter-list" id="advancedParameters" style="max-height: 400px; overflow-y: auto; padding: 10px;">
                                <!-- Advanced parameters will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Parameter Management Controls -->
                <div class="text-center mt-3">
                    <button type="button" class="btn btn-outline-light btn-sm me-2" onclick="resetParametersToDefaults()">
                        <i class="fas fa-undo me-1"></i>Reset to Defaults
                    </button>
                    <button type="button" class="btn btn-outline-info btn-sm" onclick="showParameterState()">
                        <i class="fas fa-info-circle me-1"></i>Show Current State
                    </button>
                </div>
            </div>

            <!-- Partitions Section -->
            <div class="glass-card">
                <h3><i class="fas fa-project-diagram me-2"></i>Reaction Partitions</h3>
                
                <!-- Initial Partition -->
                <div class="potential-card">
                    <h4>Initial Partition (Projectile + Target)</h4>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <h5 class="mb-3">Projectile</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="projectile" class="form-label">
                                        Symbol
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Symbol of the projectile nucleus (e.g., n, p, He3, etc.).</span>
                                        </span>
                                    </label>
                                    <input type="text" class="form-control" id="projectile" value="neutron">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="proj-mass" class="form-label">
                                        Mass (amu)
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Mass of projectile in atomic mass units.</span>
                                        </span>
                                    </label>
                                    <input type="number" class="form-control" id="proj-mass" value="1.0087" step="0.0001">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="proj-z" class="form-label">
                                        Charge (Z)
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Atomic number of the projectile.</span>
                                        </span>
                                    </label>
                                    <input type="number" class="form-control" id="proj-z" value="0">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="proj-spin" class="form-label">
                                        Spin
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Spin of the projectile in units of ħ.</span>
                                        </span>
                                    </label>
                                    <input type="number" class="form-control" id="proj-spin" value="0.5" step="0.5">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <h5 class="mb-3">Target</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="target" class="form-label">
                                        Symbol
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Symbol of the target nucleus.</span>
                                        </span>
                                    </label>
                                    <input type="text" class="form-control" id="target" value="14C">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="targ-mass" class="form-label">
                                        Mass (amu)
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Mass of target in atomic mass units.</span>
                                        </span>
                                    </label>
                                    <input type="number" class="form-control" id="targ-mass" value="14.0032" step="0.0001">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="targ-z" class="form-label">
                                        Charge (Z)
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Atomic number of the target.</span>
                                        </span>
                                    </label>
                                    <input type="number" class="form-control" id="targ-z" value="6">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="targ-spin" class="form-label">
                                        Spin
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Spin of the target in units of ħ.</span>
                                        </span>
                                    </label>
                                    <input type="number" class="form-control" id="targ-spin" value="0.0" step="0.5">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Final Partition -->
                <div class="potential-card">
                    <h4>Final Partition (Gamma + Residual)</h4>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <h5 class="mb-3">Photon</h5>
                            <div class="row">
                                <div class="col-md-12 mb-3">
                                    <label for="gamma-type" class="form-label">
                                        Photon Symbol
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">The symbol for the photon. Usually "Gamma".</span>
                                        </span>
                                    </label>
                                    <input type="text" class="form-control" id="gamma-type" value="Gamma" readonly>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="gamma-mass" class="form-label">
                                        Mass (amu)
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Mass of photon is zero.</span>
                                        </span>
                                    </label>
                                    <input type="number" class="form-control" id="gamma-mass" value="0" readonly>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="gamma-z" class="form-label">
                                        Charge (Z)
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Charge of photon is zero.</span>
                                        </span>
                                    </label>
                                    <input type="number" class="form-control" id="gamma-z" value="0" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <h5 class="mb-3">Residual Nucleus</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="residual" class="form-label">
                                        Symbol
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Symbol of the residual nucleus.</span>
                                        </span>
                                    </label>
                                    <input type="text" class="form-control" id="residual" value="15C">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="res-mass" class="form-label">
                                        Mass (amu)
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Mass of residual nucleus in atomic mass units.</span>
                                        </span>
                                    </label>
                                    <input type="number" class="form-control" id="res-mass" value="15.0106" step="0.0001">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="res-z" class="form-label">
                                        Charge (Z)
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Atomic number of the residual nucleus.</span>
                                        </span>
                                    </label>
                                    <input type="number" class="form-control" id="res-z" value="6">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="res-spin" class="form-label">
                                        Spin
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Spin of the residual nucleus in units of ħ.</span>
                                        </span>
                                    </label>
                                    <input type="number" class="form-control" id="res-spin" value="0.5" step="0.5">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="qval" class="form-label">
                                Q-value (MeV)
                                <span class="custom-tooltip">
                                    <i class="fas fa-info-circle ms-1"></i>
                                    <span class="tooltip-text">The Q-value (energy release) for the capture reaction in MeV.</span>
                                </span>
                            </label>
                            <input type="number" class="form-control" id="qval" value="1.218" step="0.001">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Electromagnetic Transition Parameters -->
            <div class="glass-card">
                <h3><i class="fas fa-bolt me-2"></i>Electromagnetic Transition</h3>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="em-mult" class="form-label">
                            Multipolarity
                            <span class="custom-tooltip">
                                <i class="fas fa-info-circle ms-1"></i>
                                <span class="tooltip-text">The multipolarity of the electromagnetic transition (e.g., E1, M1).</span>
                            </span>
                        </label>
                        <select class="form-select" id="em-mult">
                            <option value="1">E1 only</option>
                            <option value="2">M1 only</option>
                            <option value="3">E2 only</option>
                            <option value="4">E1 + M1</option>
                            <option value="5">E1 + E2</option>
                            <option value="6">All multipoles up to E2</option>
                        </select>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="gamma-spin" class="form-label">
                            Photon Spin
                            <span class="custom-tooltip">
                                <i class="fas fa-info-circle ms-1"></i>
                                <span class="tooltip-text">The spin of the photon (always 1.0).</span>
                            </span>
                        </label>
                        <input type="number" class="form-control" id="gamma-spin" value="1.0" readonly>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="binding-energy" class="form-label">
                            Binding Energy (MeV)
                            <span class="custom-tooltip">
                                <i class="fas fa-info-circle ms-1"></i>
                                <span class="tooltip-text">Binding energy of the captured particle in MeV.</span>
                            </span>
                        </label>
                        <input type="number" class="form-control" id="binding-energy" value="1.218" step="0.001">
                    </div>
                </div>
            </div>

            <!-- Potentials Section -->
            <div class="glass-card">
                <h3><i class="fas fa-atom me-2"></i>Optical Potential Parameters</h3>
                
                <!-- Comprehensive Potential Documentation -->
                <div class="alert alert-info">
                    <h5><i class="fas fa-info-circle me-2"></i>Nuclear Potential Form Factor Information</h5>
                    <p><strong>Note:</strong> TYPE=0 (Coulomb potential) is handled separately in the Coulomb potential section above. The nuclear potential options are for TYPE=1 and higher.</p>
                    <p><strong>Shape Definitions:</strong></p>
                    <ul class="mb-2">
                        <li><strong>Volume potentials (TYPE=1,8,15):</strong> R = P2*CC, RH = (r-R)/P3, E = exp(-(r-R)/P3)</li>
                        <li><strong>Surface potentials (TYPE=2):</strong> First derivative forms, normalized to -1 when E=1</li>
                        <li><strong>Spin-orbit potentials (TYPE=3,4):</strong> Multiplied by [j(j+1)-l(l+1)-s(s+1)]/2l·s, CONLS = 2.000</li>
                        <li><strong>Tensor potentials (TYPE=5,6,7):</strong> Second derivative forms, normalized to unity when E=1</li>
                    </ul>
                    <p><strong>Special Features:</strong></p>
                    <ul class="mb-0">
                        <li>If TYPE < 0: Add potential numerically to previous potential using abs(TYPE)</li>
                        <li>SHAPE ≥ 30: L/J-dependent potential with form factor</li>
                        <li>SHAPE = 40-42: Parity/L/J-dependent potentials</li>
                        <li>SHAPE 7-9: Read from external file (rewind with negative values)</li>
                    </ul>
                </div>
                
                <!-- Coulomb Potential -->
                <div class="potential-card" id="coulomb-potential">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h4>Coulomb Potential</h4>
                    </div>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="rc" class="form-label">
                                Coulomb radius (rc)
                                <span class="custom-tooltip">
                                    <i class="fas fa-info-circle ms-1"></i>
                                    <span class="tooltip-text">Coulomb radius parameter in fm. Typically 1.2-1.3 times A^(1/3).</span>
                                </span>
                            </label>
                            <input type="number" class="form-control" id="rc" value="1.3" step="0.1">
                        </div>
                    </div>
                </div>
                
                <!-- Optical Potential -->
                <div class="potential-card">
                    <h4>Optical Potential</h4>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <h5>Real Volume</h5>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="v-depth" class="form-label">
                                        Depth (V)
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Depth of the real volume potential in MeV.</span>
                                        </span>
                                    </label>
                                    <input type="number" class="form-control" id="v-depth" value="57.0" step="0.1">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="v-radius" class="form-label">
                                        Radius (r0)
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Radius parameter for the real volume potential in fm.</span>
                                        </span>
                                    </label>
                                    <input type="number" class="form-control" id="v-radius" value="1.7" step="0.1">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="v-diffuse" class="form-label">
                                        Diffuseness (a)
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Diffuseness parameter for the real volume potential in fm.</span>
                                        </span>
                                    </label>
                                    <input type="number" class="form-control" id="v-diffuse" value="0.7" step="0.01">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <h5>Imaginary Volume</h5>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="w-depth" class="form-label">
                                        Depth (W)
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Depth of the imaginary volume potential in MeV.</span>
                                        </span>
                                    </label>
                                    <input type="number" class="form-control" id="w-depth" value="0.0" step="0.1">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="w-radius" class="form-label">
                                        Radius (r0)
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Radius parameter for the imaginary volume potential in fm.</span>
                                        </span>
                                    </label>
                                    <input type="number" class="form-control" id="w-radius" value="1.7" step="0.1">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="w-diffuse" class="form-label">
                                        Diffuseness (a)
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Diffuseness parameter for the imaginary volume potential in fm.</span>
                                        </span>
                                    </label>
                                    <input type="number" class="form-control" id="w-diffuse" value="0.5" step="0.01">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-6 mb-3">
                            <h5>Spin-Orbit</h5>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="vso-depth" class="form-label">
                                        Depth (Vso)
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Depth of the spin-orbit potential in MeV.</span>
                                        </span>
                                    </label>
                                    <input type="number" class="form-control" id="vso-depth" value="0.0" step="0.1">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="vso-radius" class="form-label">
                                        Radius (r0)
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Radius parameter for the spin-orbit potential in fm.</span>
                                        </span>
                                    </label>
                                    <input type="number" class="form-control" id="vso-radius" value="1.7" step="0.1">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="vso-diffuse" class="form-label">
                                        Diffuseness (a)
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Diffuseness parameter for the spin-orbit potential in fm.</span>
                                        </span>
                                    </label>
                                    <input type="number" class="form-control" id="vso-diffuse" value="0.5" step="0.01">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Bound State Potential -->
                <div class="potential-card">
                    <h4>Bound State Potential</h4>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <h5>Real Volume</h5>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="bs-v-depth" class="form-label">
                                        Depth (V)
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Depth of the real volume potential in MeV.</span>
                                        </span>
                                    </label>
                                    <input type="number" class="form-control" id="bs-v-depth" value="55.77" step="0.01">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="bs-v-radius" class="form-label">
                                        Radius (r0)
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Radius parameter for the real volume potential in fm.</span>
                                        </span>
                                    </label>
                                    <input type="number" class="form-control" id="bs-v-radius" value="1.223" step="0.001">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="bs-v-diffuse" class="form-label">
                                        Diffuseness (a)
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Diffuseness parameter for the real volume potential in fm.</span>
                                        </span>
                                    </label>
                                    <input type="number" class="form-control" id="bs-v-diffuse" value="0.5" step="0.01">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <h5>Spin-Orbit</h5>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="bs-vso-depth" class="form-label">
                                        Depth (Vso)
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Depth of the spin-orbit potential in MeV.</span>
                                        </span>
                                    </label>
                                    <input type="number" class="form-control" id="bs-vso-depth" value="5.0" step="0.1">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="bs-vso-radius" class="form-label">
                                        Radius (r0)
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Radius parameter for the spin-orbit potential in fm.</span>
                                        </span>
                                    </label>
                                    <input type="number" class="form-control" id="bs-vso-radius" value="1.223" step="0.001">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="bs-vso-diffuse" class="form-label">
                                        Diffuseness (a)
                                        <span class="custom-tooltip">
                                            <i class="fas fa-info-circle ms-1"></i>
                                            <span class="tooltip-text">Diffuseness parameter for the spin-orbit potential in fm.</span>
                                        </span>
                                    </label>
                                    <input type="number" class="form-control" id="bs-vso-diffuse" value="0.5" step="0.01">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-4 mb-3">
                            <label for="bs-n" class="form-label">
                                Nodes (n)
                                <span class="custom-tooltip">
                                    <i class="fas fa-info-circle ms-1"></i>
                                    <span class="tooltip-text">Number of nodes in the bound state wave function (not including origin or infinity).</span>
                                </span>
                            </label>
                            <input type="number" class="form-control" id="bs-n" value="2" min="0">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="bs-l" class="form-label">
                                Orbital Angular Momentum (l)
                                <span class="custom-tooltip">
                                    <i class="fas fa-info-circle ms-1"></i>
                                    <span class="tooltip-text">Orbital angular momentum of the captured particle in the bound state.</span>
                                </span>
                            </label>
                            <input type="number" class="form-control" id="bs-l" value="0" min="0">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="bs-j" class="form-label">
                                Total Angular Momentum (j)
                                <span class="custom-tooltip">
                                    <i class="fas fa-info-circle ms-1"></i>
                                    <span class="tooltip-text">Total angular momentum (l+s) of the captured particle in the bound state.</span>
                                </span>
                            </label>
                            <input type="number" class="form-control" id="bs-j" value="0.5" step="0.5">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Generate Button -->
            <div class="text-center mt-4">
                <button type="button" id="generate-btn" class="btn btn-primary btn-lg">
                    <i class="fas fa-file-code me-2"></i>Generate Input File
                </button>
            </div>
        </form>

        <!-- Output Section -->
        <div class="glass-card mt-5">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="mb-0"><i class="fas fa-code me-2"></i>Generated Input File</h3>
                <div>
                    <button id="copy-btn" class="action-btn me-2">
                        <i class="fas fa-copy me-1"></i>Copy
                    </button>
                    <button id="download-btn" class="action-btn">
                        <i class="fas fa-download me-1"></i>Download
                    </button>
                </div>
            </div>
            <pre id="output" class="output-area">Select parameters and click "Generate Input File" to create a FRESCO input file for capture reactions.</pre>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

    <!-- Custom JavaScript -->
    <script>
        // Initialize parameter manager
        let parameterManager;
        
        (function() {
            // Initialize the parameter manager
            if (typeof FrescoParameterManager !== 'undefined') {
                parameterManager = window.FrescoParameterManager;
                parameterManager.init();
                updateParameterDisplay();
                console.log('Parameter manager initialized for capture reactions');
            } else {
                console.error('FrescoParameterManager not available');
            }
            
            // Check if FrescoNamelist is available
            console.log('DOM loaded, checking FrescoNamelist:', typeof window.FrescoNamelist);
            
            // Initialize basic form fields with configuration values
            if (window.FrescoNamelist && window.FrescoNamelist.initializeBasicFields) {
                window.FrescoNamelist.initializeBasicFields();
            }
            
            // Advanced namelist section management
            const activeNamelistSections = new Set();
            
            // Toggle namelist section function
            window.toggleNamelistSection = function(sectionName) {
                console.log('Toggle section called:', sectionName);
                console.log('FrescoNamelist available:', typeof window.FrescoNamelist);
                
                const container = document.getElementById('namelist-forms');
                if (!container) {
                    console.error('Container namelist-forms not found');
                    return;
                }
                
                const existingSection = document.getElementById(`namelist-${sectionName}`);
                
                if (existingSection) {
                    // Section exists, remove it
                    existingSection.remove();
                    activeNamelistSections.delete(sectionName);
                    console.log('Section removed:', sectionName);
                } else {
                    // Section doesn't exist, create it
                    const sectionDiv = document.createElement('div');
                    sectionDiv.id = `namelist-${sectionName}`;
                    sectionDiv.className = 'namelist-section mt-3';
                    
                    // Add a simple test content first
                    sectionDiv.innerHTML = `<div class="glass-card"><h4>Loading ${sectionName}...</h4></div>`;
                    
                    // First add the section to the DOM
                    container.appendChild(sectionDiv);
                    console.log('Section div added to DOM');
                    
                    // Then create the form in it
                    if (window.FrescoNamelist && window.FrescoNamelist.createCategoryForm) {
                        console.log('Creating category form...');
                        window.FrescoNamelist.createCategoryForm(sectionName, sectionDiv.id, {});
                    } else {
                        console.error('FrescoNamelist not available or createCategoryForm not found');
                        sectionDiv.innerHTML = '<div class="glass-card"><p class="text-danger">Error: FrescoNamelist configuration not loaded</p></div>';
                    }
                    
                    activeNamelistSections.add(sectionName);
                }
                
                // Update button states
                updateNamelistButtons();
            };
            
            // Update button appearance based on active sections
            function updateNamelistButtons() {
                document.querySelectorAll('[onclick*="toggleNamelistSection"]').forEach(button => {
                    const sectionName = button.getAttribute('onclick').match(/toggleNamelistSection\('([^']+)'\)/)[1];
                    if (activeNamelistSections.has(sectionName)) {
                        button.classList.add('active');
                    } else {
                        button.classList.remove('active');
                    }
                });
            }
            
            // Set the binding energy same as Q-value initially
            document.getElementById('binding-energy').value = document.getElementById('qval').value;
            
            // When Q-value changes, update binding energy
            document.getElementById('qval').addEventListener('change', function() {
                document.getElementById('binding-energy').value = this.value;
            });        })(); // End IIFE
        
        // Parameter management functions
        function updateParameterDisplay() {
            if (!parameterManager) return;
            
            const allocation = parameterManager.getCurrentCategorization();
            
            // Update counts
            document.getElementById('generalCount').textContent = allocation.general.length;
            document.getElementById('advancedCount').textContent = allocation.advanced.length;
            
            // Update parameter lists
            updateParameterList('generalParameters', allocation.general, 'advanced');
            updateParameterList('advancedParameters', allocation.advanced, 'general');
        }

        function updateParameterList(containerId, parameters, moveToSection) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = '';
            
            parameters.forEach(param => {
                const item = document.createElement('div');
                item.className = `parameter-item d-flex justify-content-between align-items-center p-2 mb-2 rounded ${param.isFromFile ? 'border-start border-success border-3' : ''}`;
                item.style.backgroundColor = param.isFromFile ? '#f8fff8' : '#f8f9fa';
                
                const leftDiv = document.createElement('div');
                leftDiv.className = 'd-flex align-items-center';
                
                const nameSpan = document.createElement('span');
                nameSpan.className = 'fw-bold';
                nameSpan.textContent = param.label || param.name;
                nameSpan.style.color = '#333';
                
                const valueSpan = document.createElement('span');
                valueSpan.className = 'ms-2 text-muted small';
                if (param.currentValue !== null) {
                    valueSpan.textContent = `= ${param.currentValue}`;
                }
                
                leftDiv.appendChild(nameSpan);
                leftDiv.appendChild(valueSpan);
                
                const rightDiv = document.createElement('div');
                rightDiv.className = 'd-flex align-items-center';
                
                const moveBtn = document.createElement('button');
                moveBtn.className = 'btn btn-sm btn-outline-secondary me-2';
                moveBtn.innerHTML = `<i class="fas fa-arrow-${moveToSection === 'advanced' ? 'down' : 'up'}"></i>`;
                moveBtn.title = `Move to ${moveToSection} section`;
                moveBtn.onclick = () => {
                    parameterManager.moveParameter(param.name, moveToSection);
                    updateParameterDisplay();
                };
                
                rightDiv.appendChild(moveBtn);
                
                item.appendChild(leftDiv);
                item.appendChild(rightDiv);
                container.appendChild(item);
            });
        }
        
        function resetParametersToDefaults() {
            if (parameterManager) {
                parameterManager.resetToDefaultAllocation();
                updateParameterDisplay();
                console.log('Parameters reset to default allocation');
            }
        }

        function showParameterState() {
            if (!parameterManager) return;
            
            const allocation = parameterManager.getCurrentCategorization();
            console.log('Current Parameter State:', allocation);
            alert(`Current State:\n\nGeneral: ${allocation.general.length} parameters\nAdvanced: ${allocation.advanced.length} parameters\n\nSee console for detailed information.`);
        }
        

        function resetParametersToDefaults() {
            if (!parameterManager) return;
            
            if (confirm('Reset all parameters to default allocation?')) {
                parameterManager.resetToDefaults();
                updateParameterDisplay();
                console.log('Parameters reset to default allocation');
            }
        }

        function showParameterState() {
            if (!parameterManager) return;
            
            const allocation = parameterManager.getCurrentCategorization();
            console.log('Current Parameter State:', allocation);
            alert(`Current State:\n\nGeneral: ${allocation.general.length} parameters\nAdvanced: ${allocation.advanced.length} parameters\n\nSee console for detailed information.`);
        }
        
        // Generate input file function
        window.generateInputFile = function() {
            // Get form values
            const header = document.getElementById('header').value || document.getElementById('projectile').value + '(' + document.getElementById('target').value + ',g)' + document.getElementById('residual').value;
            const hcm = document.getElementById('hcm').value;
            const rmatch = document.getElementById('rmatch').value;
            const jtmax = document.getElementById('jtmax').value;
            const absend = document.getElementById('absend').value;
            const thmax = document.getElementById('thmax').value;
            const thinc = document.getElementById('thinc').value;
            const elab = document.getElementById('elab').value;
            const iter = document.getElementById('iter').value;
            
            const projectile = document.getElementById('projectile').value;
            const projMass = document.getElementById('proj-mass').value;
            const projZ = document.getElementById('proj-z').value;
            const projSpin = document.getElementById('proj-spin').value;
            
            const target = document.getElementById('target').value;
            const targMass = document.getElementById('targ-mass').value;
            const targZ = document.getElementById('targ-z').value;
            const targSpin = document.getElementById('targ-spin').value;
            
            const residual = document.getElementById('residual').value;
            const resMass = document.getElementById('res-mass').value;
            const resZ = document.getElementById('res-z').value;
            const resSpin = document.getElementById('res-spin').value;
            
            const qval = document.getElementById('qval').value;
            const rc = document.getElementById('rc').value;
            
            const vDepth = document.getElementById('v-depth').value;
            const vRadius = document.getElementById('v-radius').value;
            const vDiffuse = document.getElementById('v-diffuse').value;
            const wDepth = document.getElementById('w-depth').value;
            const wRadius = document.getElementById('w-radius').value;
            const wDiffuse = document.getElementById('w-diffuse').value;
            const vsoDepth = document.getElementById('vso-depth').value;
            const vsoRadius = document.getElementById('vso-radius').value;
            const vsoDiffuse = document.getElementById('vso-diffuse').value;
            
            const bsVDepth = document.getElementById('bs-v-depth').value;
            const bsVRadius = document.getElementById('bs-v-radius').value;
            const bsVDiffuse = document.getElementById('bs-v-diffuse').value;
            const bsVsoDepth = document.getElementById('bs-vso-depth').value;
            const bsVsoRadius = document.getElementById('bs-vso-radius').value;
            const bsVsoDiffuse = document.getElementById('bs-vso-diffuse').value;
            
            const bsN = document.getElementById('bs-n').value;
            const bsL = document.getElementById('bs-l').value;
            const bsJ = document.getElementById('bs-j').value;
            
            const bindingEnergy = document.getElementById('binding-energy').value;
            const gammaSpin = document.getElementById('gamma-spin').value;
            const emMult = document.getElementById('em-mult').value;
            
            // Determine multipolarity based on selection
            let multipolarity = '';
            let ip1 = '-1';
            let ip2 = '1';
            
            switch(emMult) {
                case '1': // E1 only
                    multipolarity = 'E1 only';
                    ip1 = '-1';
                    ip2 = '1';
                    break;
                case '2': // M1 only
                    multipolarity = 'M1 only';
                    ip1 = '-1';
                    ip2 = '2';
                    break;
                case '3': // E2 only
                    multipolarity = 'E2 only';
                    ip1 = '-2';
                    ip2 = '1';
                    break;
                case '4': // E1 + M1
                    multipolarity = 'E1 + M1';
                    ip1 = '1';
                    ip2 = '0';
                    break;
                case '5': // E1 + E2
                    multipolarity = 'E1 + E2';
                    ip1 = '2';
                    ip2 = '1';
                    break;
                case '6': // All multipoles up to E2
                    multipolarity = 'All multipoles up to E2';
                    ip1 = '2';
                    ip2 = '0';
                    break;
            }
            
            // Collect all form data including basic and advanced parameters
            const formData = {
                hcm: parseFloat(hcm),
                rmatch: parseFloat(rmatch),
                jtmin: 0,
                jtmax: parseFloat(jtmax),
                absend: parseFloat(absend),
                thmin: 0,
                thmax: parseFloat(thmax),
                thinc: parseFloat(thinc),
                iter: parseInt(iter),
                elab: elab
            };
            
            // Use parameter manager to get all parameters
            if (parameterManager) {
                const allParameters = parameterManager.getAllParameterValues();
                Object.assign(formData, allParameters);
            }
            
            // Generate namelist using the configuration
            const namelistSection = window.FrescoNamelist.generateNamelistSection(formData);
            
            // Build the input file content
            let inputContent = `${header}
NAMELIST
${namelistSection}

 &PARTITION namep='${projectile}' massp=${projMass} zp=${projZ} nex=1 namet='${target}' masst=${targMass} zt=${targZ} qval=0.0 pwf=T /
 &STATES jp=${projSpin} copyp=0 bandp=1 ep=0.0000 kkp=0 tp=0 cpot=1 jt=${targSpin} copyt=0 bandt=1 et=0.0000 kkt=0 tt=0 /

 &PARTITION namep='Gamma' massp=0 zp=0 nex=1 namet='${residual}' masst=${resMass} zt=${resZ} qval=${qval} pwf=T /
 &STATES jp=${gammaSpin} copyp=0 bandp=1 ep=0.0000 kkp=0 tp=0 cpot=3 jt=${resSpin} copyt=0 bandt=1 et=0.0000 kkt=0 tt=0 /
 &partition / 

 &Pot kp=1 type= 0 shape= 0 p(1:3)=   ${targMass}.0000   0.0000   ${rc} /                                     
 &Pot kp=1 type= 1 shape= 0 p(1:3)=   ${vDepth}   ${vRadius}   ${vDiffuse} /`;

            // Add imaginary potential if W > 0
            if (wDepth > 0) {
                inputContent += `                                     
 &Pot kp=1 type= 2 shape= 0 p(1:3)=   ${wDepth}   ${wRadius}   ${wDiffuse} /`;
            }
            
            // Add spin-orbit potential if Vso > 0
            if (vsoDepth > 0) {
                inputContent += `                                     
 &Pot kp=1 type= 3 shape= 0 p(1:3)=   ${vsoDepth}   ${vsoRadius}   ${vsoDiffuse} /`;
            }
            
            // Add bound state potential
            inputContent += `                                     
 &Pot kp=2 type= 0 shape= 0 p(1:3)=   ${targMass}.0000   0.0000   ${rc} /                                     
 &Pot kp=2 type= 1 shape= 0 p(1:3)=   ${bsVDepth}   ${bsVRadius}   ${bsVDiffuse} /                                     
 &Pot kp=2 type= 3 shape= 0 p(1:3)=   ${bsVsoDepth}   ${bsVsoRadius}   ${bsVsoDiffuse} /                                     
 &pot / 

 &OVERLAP kn1=1 ic1=1 ic2=2 in=-2 kind=0 nn=${bsN} l=${bsL} sn=${projSpin} j=${bsJ} kbpot=2 be=${bindingEnergy} isc=1 /
 &overlap / 

 &COUPLING icto=2 icfrom=1 kind=2 ip1=${ip1} ip2=${ip2}/
 &cfp  in=2 ib=1 ia=1 kn=1  a=1.000     /
`;

            // Update output area
            document.getElementById('output').textContent = inputContent;
        }
        
        
    </script>
</body>
</html>
