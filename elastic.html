<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FRESCO Elastic Scattering Generator</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <meta name="description" content="Generate input files for FRESCO elastic scattering calculations. Configure projectile, target, and optical potential parameters.">
    <meta name="keywords" content="FRESCO, elastic scattering, nuclear physics, optical potential">
    <meta name="author" content="Jin Lei">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="stylesheet" href="assets/css/fresco-styles.css">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-J60NE88WR1"></script>
    <script src="assets/js/fresco-namelist.js"></script>
    <script src="assets/js/fresco-parameter-manager.js"></script>
    <script src="assets/js/fresco-parameter-ui.js"></script>
    <script src="assets/js/fresco-common.js"></script>
    <script src="assets/js/fresco-integration.js"></script>
    <script src="assets/js/fresco-generator.js"></script>
    <script src="assets/js/fresco-partition-states.js"></script>
    <script src="assets/js/fresco-potential.js"></script>
    <script src="assets/js/fresco-potential-ui.js"></script>
    <script src="assets/js/fresco-shared-components.js"></script>
</head>
<body>
    <!-- Header Section -->
    <header class="header">
        <div class="container">
            <h1><i class="fas fa-atom me-2"></i>Elastic Scattering</h1>
            <p>Generate FRESCO input files for elastic scattering calculations</p>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container my-4">
        <!-- Upload Section -->
        <div class="glass-card mb-4">
            <h3><i class="fas fa-upload me-2"></i>Upload Existing Input File</h3>
            <div class="row">
                <div class="col-md-6">
                    <label for="file-upload-elastic" class="form-label">
                        Select FRESCO Input File
                        <span class="custom-tooltip">
                            <i class="fas fa-info-circle ms-1"></i>
                            <span class="tooltip-text">Upload an existing FRESCO input file (.in, .inp, .txt) to populate the form fields automatically.</span>
                        </span>
                    </label>
                    <input type="file" class="form-control" id="file-upload-elastic" accept=".in,.inp,.txt" onchange="handleFileUpload(event, 'elastic')">
                </div>
                <div class="col-md-6 d-flex align-items-end">
                    <button type="button" class="glass-btn" onclick="document.getElementById('file-upload-elastic').click()">
                        <i class="fas fa-folder-open me-2"></i>Browse Files
                    </button>
                </div>
            </div>
            <small class="form-text">Supported formats: .in, .inp, .txt</small>
        </div>

        <form id="elastic-form">
            <!-- General Parameters -->
            <div class="glass-card">
                <h3><i class="fas fa-cogs me-2"></i>General FRESCO Parameters</h3>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="header" class="form-label">
                            Header
                            <span class="custom-tooltip">
                                <i class="fas fa-info-circle ms-1"></i>
                                <span class="tooltip-text">Description of the calculation that will appear at the top of the input file.</span>
                            </span>
                        </label>
                        <input type="text" class="form-control" id="header" placeholder="p+Ni78 Coulomb and Nuclear;">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="hcm" class="form-label">
                            Integration step size (hcm)
                            <span class="custom-tooltip">
                                <i class="fas fa-info-circle ms-1"></i>
                                <span class="tooltip-text">Step size for integration in center-of-mass frame. Smaller values give more accurate results but slower calculations (typical: 0.05-0.1).</span>
                            </span>
                        </label>
                        <input type="number" class="form-control" id="hcm" value="0.1" step="0.01">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="rmatch" class="form-label">
                            Matching radius (rmatch)
                            <span class="custom-tooltip">
                                <i class="fas fa-info-circle ms-1"></i>
                                <span class="tooltip-text">The radius at which the internal and asymptotic solutions are matched (typical: 20-60 fm).</span>
                            </span>
                        </label>
                        <input type="number" class="form-control" id="rmatch" value="60">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="jtmax" class="form-label">
                            Max angular momentum (jtmax)
                            <span class="custom-tooltip">
                                <i class="fas fa-info-circle ms-1"></i>
                                <span class="tooltip-text">Maximum angular momentum included in the calculation. Higher values needed for higher energies and heavier systems.</span>
                            </span>
                        </label>
                        <input type="number" class="form-control" id="jtmax" value="50">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="absend" class="form-label">
                            Convergence parameter (absend)
                            <span class="custom-tooltip">
                                <i class="fas fa-info-circle ms-1"></i>
                                <span class="tooltip-text">Convergence criterion. Smaller values give more precise results (typical: 0.001-0.01).</span>
                            </span>
                        </label>
                        <input type="number" class="form-control" id="absend" value="0.001" step="0.001">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="thmax" class="form-label">
                            Maximum angle (thmax)
                            <span class="custom-tooltip">
                                <i class="fas fa-info-circle ms-1"></i>
                                <span class="tooltip-text">Maximum scattering angle in degrees.</span>
                            </span>
                        </label>
                        <input type="number" class="form-control" id="thmax" value="180">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="thinc" class="form-label">
                            Angle increment (thinc)
                            <span class="custom-tooltip">
                                <i class="fas fa-info-circle ms-1"></i>
                                <span class="tooltip-text">Increment between calculated scattering angles in degrees.</span>
                            </span>
                        </label>
                        <input type="number" class="form-control" id="thinc" value="1.0" step="0.1">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="elab" class="form-label">
                            Laboratory energy (elab)
                            <span class="custom-tooltip">
                                <i class="fas fa-info-circle ms-1"></i>
                                <span class="tooltip-text">Laboratory energy of the projectile in MeV. For multi-energy calculations, use comma-separated values.</span>
                            </span>
                        </label>
                        <input type="text" class="form-control" id="elab" value="6.9, 11.0, 49.35">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="iter" class="form-label">
                            Number of iterations (iter)
                            <span class="custom-tooltip">
                                <i class="fas fa-info-circle ms-1"></i>
                                <span class="tooltip-text">Number of iterations for solving coupled equations. For elastic scattering only, value of 1 is sufficient.</span>
                            </span>
                        </label>
                        <input type="number" class="form-control" id="iter" value="1" min="1">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="rintp" class="form-label">
                            Integration mesh size (rintp)
                            <span class="custom-tooltip">
                                <i class="fas fa-info-circle ms-1"></i>
                                <span class="tooltip-text">Radial integration mesh size in fm. Typical values are 0.1-0.5 fm.</span>
                            </span>
                        </label>
                        <input type="number" class="form-control" id="rintp" step="0.1">
                    </div>
                </div>
            </div>

            <!-- Dynamic Parameter Management System -->
            <div class="glass-card advanced-fresco-card">
                <h3 class="d-flex justify-content-between align-items-center" style="cursor: pointer;" data-bs-toggle="collapse" data-bs-target="#parameterManagementContent" aria-expanded="false">
                    <span><i class="fas fa-sliders-h me-2"></i>FRESCO Parameter Management</span>
                    <i class="fas fa-chevron-down" id="paramMgmtToggleIcon"></i>
                </h3>

                <div class="collapse" id="parameterManagementContent">
                    <p class="text-white-50 mb-3">Dynamically manage parameters between General and Advanced sections. Upload a FRESCO file to automatically populate parameters.</p>

                    <!-- Parameter Sections -->
                    <div class="row">
                    <!-- General Parameters -->
                    <div class="col-md-6">
                        <div class="parameter-section mb-3" style="border: 1px solid #444; border-radius: 8px; overflow: hidden;">
                            <div class="section-header" style="background: #2c3e50; color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center;">
                                <span><i class="fas fa-star me-2"></i>General FRESCO Parameters</span>
                                <span class="badge bg-primary" id="generalCount">0</span>
                            </div>
                            <div class="parameter-list" id="generalParameters" style="max-height: 400px; overflow-y: auto; padding: 10px;">
                                <!-- General parameters will be populated here -->
                            </div>
                        </div>
                    </div>

                    <!-- Advanced Parameters -->
                    <div class="col-md-6">
                        <div class="parameter-section mb-3" style="border: 1px solid #444; border-radius: 8px; overflow: hidden;">
                            <div class="section-header" style="background: #8e44ad; color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center;">
                                <span><i class="fas fa-cogs me-2"></i>Advanced FRESCO Parameters</span>
                                <span class="badge bg-secondary" id="advancedCount">0</span>
                            </div>
                            <div class="parameter-list" id="advancedParameters" style="max-height: 400px; overflow-y: auto; padding: 10px;">
                                <!-- Advanced parameters will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                    <!-- Parameter Management Controls -->
                    <div class="text-center mt-3">
                        <button type="button" class="btn btn-outline-light btn-sm me-2" onclick="resetParametersToDefaults()">
                            <i class="fas fa-undo me-1"></i>Reset to Defaults
                        </button>
                        <button type="button" class="btn btn-outline-info btn-sm" onclick="showParameterState()">
                            <i class="fas fa-info-circle me-1"></i>Show Current State
                        </button>
                    </div>
                </div>
            </div>

            <!-- Partition Parameters -->
            <div class="glass-card">
                <h3><i class="fas fa-project-diagram me-2"></i>Partition Parameters</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <h4 class="mb-3">Projectile</h4>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="projectile" class="form-label">
                                    Symbol
                                    <span class="custom-tooltip">
                                        <i class="fas fa-info-circle ms-1"></i>
                                        <span class="tooltip-text">Symbol of the projectile nucleus (e.g., p, d, He3, etc.).</span>
                                    </span>
                                </label>
                                <input type="text" class="form-control" id="projectile" value="p">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="proj-mass" class="form-label">
                                    Mass (amu)
                                    <span class="custom-tooltip">
                                        <i class="fas fa-info-circle ms-1"></i>
                                        <span class="tooltip-text">Mass of projectile in atomic mass units.</span>
                                    </span>
                                </label>
                                <input type="number" class="form-control" id="proj-mass" value="1.00" step="0.01">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="proj-z" class="form-label">
                                    Charge (Z)
                                    <span class="custom-tooltip">
                                        <i class="fas fa-info-circle ms-1"></i>
                                        <span class="tooltip-text">Atomic number of the projectile.</span>
                                    </span>
                                </label>
                                <input type="number" class="form-control" id="proj-z" value="1">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="proj-spin" class="form-label">
                                    Spin
                                    <span class="custom-tooltip">
                                        <i class="fas fa-info-circle ms-1"></i>
                                        <span class="tooltip-text">Spin of the projectile in units of ħ.</span>
                                    </span>
                                </label>
                                <input type="number" class="form-control" id="proj-spin" value="0.5" step="0.5">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <h4 class="mb-3">Target</h4>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="target" class="form-label">
                                    Symbol
                                    <span class="custom-tooltip">
                                        <i class="fas fa-info-circle ms-1"></i>
                                        <span class="tooltip-text">Symbol of the target nucleus.</span>
                                    </span>
                                </label>
                                <input type="text" class="form-control" id="target" value="Ni78">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="targ-mass" class="form-label">
                                    Mass (amu)
                                    <span class="custom-tooltip">
                                        <i class="fas fa-info-circle ms-1"></i>
                                        <span class="tooltip-text">Mass of target in atomic mass units.</span>
                                    </span>
                                </label>
                                <input type="number" class="form-control" id="targ-mass" value="78.0" step="0.1">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="targ-z" class="form-label">
                                    Charge (Z)
                                    <span class="custom-tooltip">
                                        <i class="fas fa-info-circle ms-1"></i>
                                        <span class="tooltip-text">Atomic number of the target.</span>
                                    </span>
                                </label>
                                <input type="number" class="form-control" id="targ-z" value="28">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="targ-spin" class="form-label">
                                    Spin
                                    <span class="custom-tooltip">
                                        <i class="fas fa-info-circle ms-1"></i>
                                        <span class="tooltip-text">Spin of the target in units of ħ.</span>
                                    </span>
                                </label>
                                <input type="number" class="form-control" id="targ-spin" value="0.0" step="0.5">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Potentials Section -->
            <div class="glass-card">
                <h3><i class="fas fa-atom me-2"></i>Potential Parameters</h3>
                
                <!-- Comprehensive Potential Documentation -->
                <div class="alert alert-info">
                    <h5><i class="fas fa-info-circle me-2"></i>Nuclear Potential Form Factor Information</h5>
                    <p><strong>Note:</strong> TYPE=0 (Coulomb potential) is handled separately in the Coulomb potential section above. The nuclear potential options below are for TYPE=1 and higher.</p>
                    <p><strong>Shape Definitions:</strong></p>
                    <ul class="mb-2">
                        <li><strong>Volume potentials (TYPE=1,8,15):</strong> R = P2*CC, RH = (r-R)/P3, E = exp(-(r-R)/P3)</li>
                        <li><strong>Surface potentials (TYPE=2):</strong> First derivative forms, normalized to -1 when E=1</li>
                        <li><strong>Spin-orbit potentials (TYPE=3,4):</strong> Multiplied by [j(j+1)-l(l+1)-s(s+1)]/2l·s, CONLS = 2.000</li>
                        <li><strong>Tensor potentials (TYPE=5,6,7):</strong> Second derivative forms, normalized to unity when E=1</li>
                    </ul>
                    <p><strong>Special Features:</strong></p>
                    <ul class="mb-0">
                        <li>If TYPE < 0: Add potential numerically to previous potential using abs(TYPE)</li>
                        <li>SHAPE ≥ 30: L/J-dependent potential with form factor</li>
                        <li>SHAPE = 40-42: Parity/L/J-dependent potentials</li>
                        <li>SHAPE 7-9: Read from external file (rewind with negative values)</li>
                    </ul>
                </div>
                
                <!-- Coulomb Potential -->
                <div class="potential-card" id="coulomb-potential">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h4>Coulomb Potential</h4>
                    </div>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="rc" class="form-label">
                                Coulomb radius (rc)
                                <span class="custom-tooltip">
                                    <i class="fas fa-info-circle ms-1"></i>
                                    <span class="tooltip-text">Coulomb radius parameter in fm. Typically 1.2-1.3 times A^(1/3).</span>
                                </span>
                            </label>
                            <input type="number" class="form-control" id="rc" value="1.2" step="0.1">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="ap" class="form-label">
                                Projectile mass number (ap)
                                <span class="custom-tooltip">
                                    <i class="fas fa-info-circle ms-1"></i>
                                    <span class="tooltip-text">Mass number of the projectile used for Coulomb potential calculation.</span>
                                </span>
                            </label>
                            <input type="number" class="form-control" id="ap" value="1.0" step="0.1">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="at" class="form-label">
                                Target mass number (at)
                                <span class="custom-tooltip">
                                    <i class="fas fa-info-circle ms-1"></i>
                                    <span class="tooltip-text">Mass number of the target used for Coulomb potential calculation.</span>
                                </span>
                            </label>
                            <input type="number" class="form-control" id="at" value="78.0" step="0.1">
                        </div>
                    </div>
                </div>
                
                <!-- Nuclear Potentials -->
                <div id="potential-container">
                    <!-- This will be filled with potential cards -->
                </div>
                
                <!-- Add Potential Button -->
                <div class="add-potential-btn" id="add-potential-btn">
                    <i class="fas fa-plus me-2"></i>Add Nuclear Potential
                </div>
            </div>

            <!-- Generate Button -->
            <div class="text-center mt-4">
                <button type="button" id="generate-btn" class="btn btn-primary btn-lg">
                    <i class="fas fa-file-code me-2"></i>Generate Input File
                </button>
            </div>
        </form>

        <!-- Output Section -->
        <div class="glass-card mt-5">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="mb-0"><i class="fas fa-code me-2"></i>Generated Input File</h3>
                <div>
                    <button id="copy-btn" class="action-btn me-2">
                        <i class="fas fa-copy me-1"></i>Copy
                    </button>
                    <button id="download-btn" class="action-btn">
                        <i class="fas fa-download me-1"></i>Download
                    </button>
                </div>
            </div>
            <pre id="output" class="output-area">Select parameters and click "Generate Input File" to create a FRESCO input file for elastic scattering.</pre>
        </div>
    </div>

    <!-- Potential Template -->
    <template id="potential-template">
        <div class="potential-card" data-potential-id="">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h4>Nuclear Potential <span class="potential-number"></span></h4>
                <a href="#" class="remove-potential"><i class="fas fa-times"></i></a>
            </div>
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label for="potential-type" class="form-label">
                        Potential Type
                        <span class="custom-tooltip">
                            <i class="fas fa-info-circle ms-1"></i>
                            <span class="tooltip-text">Type of nuclear potential.</span>
                        </span>
                    </label>
                    <select class="form-select potential-type">
                        <option value="1" selected>1 - Central potential, Volume</option>
                        <option value="2">2 - Central potential, Derivative (surface)</option>
                        <option value="3">3 - Spin-orbit for projectile</option>
                        <option value="4">4 - Spin-orbit for target</option>
                        <option value="5">5 - Tr tensor force for projectile</option>
                        <option value="6">6 - Tr tensor force for target</option>
                        <option value="7">7 - Tensor force between L and combined spins</option>
                        <option value="8">8 - Nucleon-nucleon SSC potential</option>
                        <option value="9">9 - User-supplied nucleon-nucleon potential</option>
                        <option value="10">10 - Deformed projectile (matrix elements from ROTOR)</option>
                        <option value="11">11 - Deformed target (matrix elements from ROTOR)</option>
                        <option value="12">12 - Projectile coupled by matrix elements read in</option>
                        <option value="13">13 - Target coupled by matrix elements read in</option>
                        <option value="14">14 - Projectile second-order coupled by matrix elements</option>
                        <option value="15">15 - Central potential, Volume (for TYPE 15)</option>
                        <option value="16">16 - Target & projectile simultaneous second-order coupled</option>
                        <option value="17">17 - Target & projectile all-order coupled</option>
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label for="potential-shape" class="form-label">
                        Shape
                        <span class="custom-tooltip">
                            <i class="fas fa-info-circle ms-1"></i>
                            <span class="tooltip-text">Radial shape of the form factor. TYPE < 0 adds potential numerically to previous potential.</span>
                        </span>
                    </label>
                    <select class="form-select potential-shape">
                        <option value="0" selected>0 - Woods-Saxon: -P1/(1+1/E)</option>
                        <option value="1">1 - WS squared: -P1/(1+1/E)²</option>
                        <option value="2">2 - Gaussian: -P1*exp(-RH²)</option>
                        <option value="3">3 - Yukawa: -P1*E/r</option>
                        <option value="4">4 - Exponential: -P1*E</option>
                        <option value="5">5 - Reid soft core T=0, central part</option>
                        <option value="6">6 - Reid soft core T=1, central part</option>
                        <option value="7">7 - Read Real from file</option>
                        <option value="8">8 - Read Imaginary from file</option>
                        <option value="9">9 - Read Complex from file</option>
                        <option value="-1">-1 - Fourier-Bessel: j₀(RH) = sin(RH)/RH</option>
                        <option value="-7">-7 - Rewind and read Real from file</option>
                        <option value="-8">-8 - Rewind and read Imaginary from file</option>
                        <option value="-9">-9 - Rewind and read Complex from file</option>
                        <option value="10">10 - Write potential to Output file 25</option>
                        <option value="20">20 - J-dependent potential from file</option>
                        <option value="21">21 - J-dependent potential from file</option>
                        <option value="22">22 - J-dependent potential from file</option>
                        <option value="23">23 - J-dependent potential from file</option>
                        <option value="24">24 - J-dependent potential from file</option>
                        <option value="30">30 - L/J-dependent form factor</option>
                        <option value="40">40 - Parity-dependent: P1 for +, P2 for -</option>
                        <option value="41">41 - L-dependent: P(L+1) for L=0-5</option>
                        <option value="42">42 - J-dependent: P(Ji+1) for Ji=0-5</option>
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label for="it-field" class="form-label">
                        IT Parameter
                        <span class="custom-tooltip">
                            <i class="fas fa-info-circle ms-1"></i>
                            <span class="tooltip-text">1 or 3: include only iteratively; 2 or 3: do NOT subtract in KIND=3,4 single-particle couplings</span>
                        </span>
                    </label>
                    <select class="form-select it-field">
                        <option value="1" selected>1 - Include iteratively only</option>
                        <option value="2">2 - Do not subtract in KIND=3,4</option>
                        <option value="3">3 - Both: iterative & no subtract</option>
                    </select>
                </div>
            </div>
            <div class="row real-params">
                <div class="col-md-12 mb-2">
                    <h5>Real Part</h5>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">
                        Depth (p1)
                        <span class="custom-tooltip">
                            <i class="fas fa-info-circle ms-1"></i>
                            <span class="tooltip-text">Depth of the real part of the potential in MeV.</span>
                        </span>
                    </label>
                    <input type="number" class="form-control p1" value="40.0" step="0.1">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">
                        Radius (p2)
                        <span class="custom-tooltip">
                            <i class="fas fa-info-circle ms-1"></i>
                            <span class="tooltip-text">Radius parameter for the potential in fm.</span>
                        </span>
                    </label>
                    <input type="number" class="form-control p2" value="1.2" step="0.1">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">
                        Diffuseness (p3)
                        <span class="custom-tooltip">
                            <i class="fas fa-info-circle ms-1"></i>
                            <span class="tooltip-text">Diffuseness parameter for the potential in fm.</span>
                        </span>
                    </label>
                    <input type="number" class="form-control p3" value="0.65" step="0.01">
                </div>
            </div>
            <div class="row imag-params">
                <div class="col-md-12 mb-2">
                    <h5>Imaginary Part</h5>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">
                        Depth (p4)
                        <span class="custom-tooltip">
                            <i class="fas fa-info-circle ms-1"></i>
                            <span class="tooltip-text">Depth of the imaginary part of the potential in MeV.</span>
                        </span>
                    </label>
                    <input type="number" class="form-control p4" value="10.0" step="0.1">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">
                        Radius (p5)
                        <span class="custom-tooltip">
                            <i class="fas fa-info-circle ms-1"></i>
                            <span class="tooltip-text">Radius parameter for the imaginary potential in fm.</span>
                        </span>
                    </label>
                    <input type="number" class="form-control p5" value="1.2" step="0.1">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">
                        Diffuseness (p6)
                        <span class="custom-tooltip">
                            <i class="fas fa-info-circle ms-1"></i>
                            <span class="tooltip-text">Diffuseness parameter for the imaginary potential in fm.</span>
                        </span>
                    </label>
                    <input type="number" class="form-control p6" value="0.5" step="0.01">
                </div>
            </div>
            <div class="row additional-params">
                <div class="col-md-12 mb-2">
                    <h5>Additional Parameters</h5>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">
                        P0 Parameter
                        <span class="custom-tooltip">
                            <i class="fas fa-info-circle ms-1"></i>
                            <span class="tooltip-text">Additional parameter P0. Used for L≥6 in L-dependent potentials (SHAPE=41) or Ji≥6 in J-dependent potentials (SHAPE=42).</span>
                        </span>
                    </label>
                    <input type="number" class="form-control p0" value="0.0" step="0.01">
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">
                        P7 Parameter
                        <span class="custom-tooltip">
                            <i class="fas fa-info-circle ms-1"></i>
                            <span class="tooltip-text">Further parameter P7 for specialized potential forms.</span>
                        </span>
                    </label>
                    <input type="number" class="form-control p7" value="0.0" step="0.01">
                </div>
            </div>
        </div>
    </template>

    <!-- JavaScript Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

    <!-- Custom JavaScript -->
    <script>
        // Initialize immediately since script is at bottom of page
        (function() {
            // Define default general parameters for elastic scattering
            const elasticDefaultGeneralParams = [
                'hcm', 'rmatch', 'jtmax', 'absend',
                'thmin', 'thmax', 'thinc',
                'elab', 'iter',
                'chans', 'smats', 'xstabl'
            ];

            // Initialize the parameter UI with elastic-specific defaults
            if (typeof window.FrescoParameterUI !== 'undefined') {
                window.FrescoParameterUI.init(elasticDefaultGeneralParams);
                console.log('Parameter UI initialized for elastic scattering');
            } else {
                console.error('FrescoParameterUI not available');
            }

            // Toggle chevron icon for Parameter Management collapse
            const paramMgmtContent = document.getElementById('parameterManagementContent');
            const paramMgmtIcon = document.getElementById('paramMgmtToggleIcon');
            if (paramMgmtContent && paramMgmtIcon) {
                paramMgmtContent.addEventListener('show.bs.collapse', function() {
                    paramMgmtIcon.classList.remove('fa-chevron-down');
                    paramMgmtIcon.classList.add('fa-chevron-up');
                });
                paramMgmtContent.addEventListener('hide.bs.collapse', function() {
                    paramMgmtIcon.classList.remove('fa-chevron-up');
                    paramMgmtIcon.classList.add('fa-chevron-down');
                });
            }

            // Initialize ap and at fields with the corresponding mass values
            document.getElementById('ap').value = document.getElementById('proj-mass').value;
            document.getElementById('at').value = document.getElementById('targ-mass').value;

            // Add event listeners to update ap and at when proj-mass and targ-mass change
            document.getElementById('proj-mass').addEventListener('change', function() {
                document.getElementById('ap').value = this.value;
            });

            document.getElementById('targ-mass').addEventListener('change', function() {
                document.getElementById('at').value = this.value;
            });

            // Initialize the new potential management system
            if (typeof window.FrescoPotentialUI !== 'undefined') {
                window.FrescoPotentialUI.init(
                    'elastic',                      // Reaction type
                    'potential-container',          // Container ID
                    'add-potential-btn',            // Add button ID
                    'coulomb-potential'             // Coulomb form ID
                );
                console.log('Potential UI initialized for elastic scattering');
            } else {
                console.error('FrescoPotentialUI not available');
            }
            
            // Generate FRESCO input file
            // Copy to clipboard
            // Download file
            // Generate input file function
            window.generateInputFile = function() {
                // Get form values
                const header = document.getElementById('header').value || 'p+Ni78 Coulomb and Nuclear;';
                const hcm = document.getElementById('hcm').value;
                const rmatch = document.getElementById('rmatch').value;
                const jtmax = document.getElementById('jtmax').value;
                const absend = document.getElementById('absend').value;
                const thmax = document.getElementById('thmax').value;
                const thinc = document.getElementById('thinc').value;
                const elab = document.getElementById('elab').value;
                const iter = document.getElementById('iter').value;
                const rintp = document.getElementById('rintp').value;
                
                const projectile = document.getElementById('projectile').value;
                const projMass = document.getElementById('proj-mass').value;
                const projZ = document.getElementById('proj-z').value;
                const projSpin = document.getElementById('proj-spin').value;
                
                const target = document.getElementById('target').value;
                const targMass = document.getElementById('targ-mass').value;
                const targZ = document.getElementById('targ-z').value;
                const targSpin = document.getElementById('targ-spin').value;
                
                const rc = document.getElementById('rc').value;
                const ap = document.getElementById('ap').value;
                const at = document.getElementById('at').value;
                
                // Collect all form data including basic and advanced parameters
                const formData = {
                    hcm: parseFloat(hcm),
                    rmatch: parseFloat(rmatch),
                    jtmin: 0.0,
                    jtmax: parseFloat(jtmax),
                    absend: parseFloat(absend),
                    thmin: 0.0,
                    thmax: parseFloat(thmax),
                    thinc: parseFloat(thinc),
                    chans: 1,
                    smats: 2,
                    xstabl: 1,
                    elab: elab,
                    iter: parseInt(iter)
                };
                
                // Add rintp only if it has a value
                if (rintp && rintp.trim() !== '') {
                    formData.rintp = parseFloat(rintp);
                }

                // Collect all FRESCO namelist parameters using shared function
                // This automatically collects from:
                // - General FRESCO Parameters section (default + dynamically added)
                // - Advanced parameter sections (if open)
                // - Uploaded input file parameters
                const allFrescoParams = window.getAllFrescoParameters();
                Object.assign(formData, allFrescoParams);

                // Generate namelist using the configuration
                const namelistSection = window.FrescoNamelist.generateNamelistSection(formData);

                // Generate &PARTITION and &STATES namelists using the existing form data
                const partitionStatesSection = window.FrescoPartitionStates.generateSingle(
                    projectile, projMass, projZ, projSpin,
                    target, targMass, targZ, targSpin,
                    0 // qval
                );

                // Generate &POT namelists using the new potential system
                const potentialSection = window.FrescoPotentialUI.generatePotentialSection();

                // Build the input file content
                let inputContent = `${header}
NAMELIST
${namelistSection}

${partitionStatesSection}
${potentialSection}`;

                // End input file
                inputContent += `
 &pot / 
 &overlap / 
 &coupling / 



`; // Added multiple empty lines for FRESCO stdin reading

                // Update output area
                document.getElementById('output').textContent = inputContent;
            }
        })(); // End IIFE - script runs immediately since it's at bottom of page
    </script>
</body>
</html>